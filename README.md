# Inventory Service & Action History Service

## Описание

**Inventory Service** предназначен для управления товарами и их остатками на полках магазинов. **Action History Service** используется для записи всех действий, связанных с товарами и остатками, включая создание, изменение и удаление данных.

## Технологии

- Node.js
- Express.js
- Sequelize ORM
- PostgreSQL
- Axios (для межсервисного взаимодействия)

## Конфигурация

Перед запуском сервисов, создайте файл `.env` в каждом сервисе (`inventory_service` и `action_history_service`) для хранения конфигурационных параметров, таких как данные для подключения к базе данных.

### Пример файла `.env`

Создайте файл `.env` в корневой папке каждого сервиса и добавьте в него следующие настройки:

**Для `inventory_service`**

DB_HOST=localhost 
DB_PORT=5432 
DB_NAME=inventory_db 
DB_USER=your_database_user 
DB_PASSWORD=your_database_password 


> **Примечание**: Замените `your_database_user` и `your_database_password` на реальные данные для подключения к базе данных PostgreSQL.

После создания файла `.env` в каждом сервисе, сервисы смогут использовать эти переменные для конфигурации базы данных и порта.

## Установка и запуск

1. Установите зависимости для каждого сервиса:

   ```bash
   cd inventory_service
   npm install

   cd ../action_history_service
   npm install
    ```
2. Запустите оба сервиса (последовательно в отдельных терминалах):

```bash
Копировать код
cd inventory_service
node index.js

cd ../action_history_service
npx ts-node index.ts
```

## Описание API

### Inventory Service

Сервис работает на порту `3001`.

#### 1. Создание товара

- **URL**: `POST /products`
- **Описание**: Создает новый товар с уникальным `plu`.
- **Тело запроса (JSON)**:
  ```json
  {
    "plu": "12345",
    "name": "Example Product"
  }
  ```
#### 2. Создание остатка 

- **URL**: POST /stocks
- **Описание**: Создает запись об остатке товара в определенном магазине.
- **Тело запроса (JSON)**:
```json
{
  "product_id": 1,
  "shop_id": 1,
  "on_shelf": 20,
  "in_order": 5
}
```
#### 3. Увеличение остатка
- **URL**: PUT /stocks/increase
- **Описание**: Увеличивает количество товара на полке и/или в заказе.
- **Тело запроса (JSON)**:
```json
{
  "stockId": 1,
  "increaseOnShelf": 10,
  "increaseInOrder": 2
}
```
#### 4. Уменьшение остатка
- **URL**: PUT /stocks/decrease
- **Описание**: Уменьшает количество товара на полке и/или в заказе
- **Тело запроса (JSON)**:
```json
{
  "stockId": 1,
  "decreaseOnShelf": 5,
  "decreaseInOrder": 1
}
```
#### 5. Получение остатков по фильтрам

- **URL**: `GET /stocks`
- **Описание**: Возвращает список остатков, соответствующих фильтрам.
- **Параметры запроса**:
  - `plu`: (опционально) PLU товара.
  - `shop_id`: (опционально) ID магазина.
  - `on_shelf_min` и `on_shelf_max`: (опционально) Диапазон остатков на полке.
  - `in_order_min` и `in_order_max`: (опционально) Диапазон остатков в заказе.
- **Ответ**: Массив объектов с данными остатков.

### Action History Service

Сервис работает на порту `3002`.

#### 1. Получение истории действий

- **URL**: `GET /actions`
- **Описание**: Возвращает список действий, соответствующих фильтрам.
- **Параметры запроса**:
  - `shop_id`: (опционально) ID магазина.
  - `plu`: (опционально) PLU товара.
  - `action`: (опционально) Тип действия (`create`, `create_stock`, `increase_stock`, `decrease_stock`).
  - `date_from` и `date_to`: (опционально) Диапазон дат для фильтрации по дате.
  - `page` и `limit`: (опционально) Параметры для постраничной навигации.
- **Ответ**: Массив объектов с данными истории действий.

#### 2. Запись действия

- **URL**: `POST /actions`
- **Описание**: Создает запись о действии (этот запрос вызывается `inventory_service` автоматически при выполнении операций над товарами и остатками).
- **Тело запроса (JSON)**:
  ```json
  {
    "product_id": 1,
    "shop_id": 1,
    "plu": "12345",
    "action": "create_stock",
    "date": "2024-11-17T10:00:00Z"
  }
  ```
  
## Пример использования

1. Создайте товар через `POST /products`.
2. Создайте остаток для этого товара через `POST /stocks`.
3. Увеличьте и уменьшите остаток через `PUT /stocks/increase` и `PUT /stocks/decrease`.
4. Проверьте историю действий через `GET /actions`.

## Дополнительные проверки и валидации

- Все действия, такие как создание товара и изменение остатка, автоматически записываются в `Action History Service`.
- Убедитесь, что `plu` уникален при создании товара.
- Убедитесь, что запросы на изменение остатка не допускают отрицательных значений.

## Возможные улучшения

- Добавить аутентификацию и авторизацию.
- Реализовать мониторинг сервисов и логирование ошибок в централизованную систему.
- Добавить автоматическое тестирование.
